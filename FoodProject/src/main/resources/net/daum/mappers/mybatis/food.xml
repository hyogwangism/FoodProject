<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
  
  <mapper namespace="food">
  	
  	<!-- 전체  목록 -->
  	<select id="food_all_list" resultType="food">
  		select * from food order by #{food_no} asc
  	</select>

  	<!-- 특정 탭  목록 -->
  	<select id="food_list" resultType="food" parameterType="string">
  		select * from food where food_type = #{food_type} order by #{food_no} asc
  	</select>
  		
  	
  	<!-- 게시물 내용 -->
  	<select id="food_cont" parameterType="int" resultType="food">
  		select * from food where food_no = #{food_no}
  	</select>
  	
  	<!-- 게시물 등록 -->
  	<insert id="food_in" parameterType="food">
  		insert into food 
  		values (food_no_seq.nextval, #{food_place}, #{food_name}, #{food_taste}, #{food_amount}, #{food_location},
  		#{food_type}, #{food_space}, #{food_price}, #{food_parking}, #{food_review}, #{food_photo01}, #{food_photo02}, #{food_photo03})
  	</insert>
  	
  	<!-- 게시물 수정 -->
  	<update id="food_edit" >
  		update food 
  		set  
  		food_place = #{food_place}, food_name = #{food_name}, food_taste = #{food_taste} 
  		, food_amount = #{food_amount}, food_location = #{food_location}, food_type = #{food_type} 
  		, food_space = #{food_space}, food_price = #{food_price}, food_parking = #{food_parking}
  		, food_review = #{food_review}, food_photo01 = #{food_photo01}, food_photo02 = #{food_photo02}, food_photo03 = #{food_photo03}
  		  where food_no = #{food_no}
  	</update>
  	
  	<delete id="food_del">
  		delete from food where food_no = #{food_no}	
  	</delete>
  	

<!-- 체크박스 검색  -->
<select id="items" resultType="net.daum.vo.FoodVO">
  SELECT * FROM Food
  <where>
    <if test="list1 != null and list1.size() > 0">
      AND food_type IN (
        <foreach collection="list1" item="item" separator="," close=")">
          #{item}
        </foreach>
    </if>
    <if test="list2 != null and list2.size() > 0">
      AND food_location IN (
        <foreach collection="list2" item="item" separator="," close=")">
          #{item}
        </foreach> 
    </if>
    <if test="food_type != null">
      AND food_type = #{food_type}
    </if>
  </where>
</select>

<!-- 전체일때 체크박스 검색  -->
<select id="items2" resultType="food">
  SELECT * FROM Food
  <where>
    <if test="list1 != null and list1.size() > 0">
      AND food_type IN (
        <foreach collection="list1" item="item" separator="," close=")">
          #{item}
        </foreach>
      
    </if>
    <if test="list2 != null and list2.size() > 0">
      AND food_location IN (
        <foreach collection="list2" item="item" separator="," close=")">
          #{item}
        </foreach> 
      
    </if>
    <if test="food_type != null">
      AND food_type IN (한식, 중식, 일식, 양식, 기타, 디저트)
    </if>
  </where>
</select>

  	 <!-- 검색필드로 음식 검색  -->
    <select id="searchFoodList" resultType="food">
     select * from food
      <if test="search_type == 'All'">
      order by food_no asc
      </if>
      <where>
      <if test="search_type == 'food_place'">
       food_place like #{search_field} order by food_no asc
      </if>
      <if test="search_type == 'food_name'">
       food_name like #{search_field} order by food_no asc
      </if>
      </where>
    </select>  
  	
<!-- 	
<select id="items" resultType="net.daum.vo.FoodVO">
  SELECT * FROM Food
  <where>
    <if test="list.size != 0">
    AND (
      <if test="list.food_type.size != 0">
        <foreach collection="list" item="item" open="food_type IN (" separator="," close=")">
          #{item.food_type}
        </foreach>
      </if>
      
      <if test="list.food_location.size != 0">
        AND
        <foreach collection="list" item="item" open="food_location IN (" separator="," close=")">   
          #{item.food_location}
        </foreach>
      </if>
      )
    </if>
  </where>
</select>
 -->


<!-- 
1.SELECT * FROM Food

2.SELECT * FROM Food
WHERE 
  (price IN (10000,15000,20000))

3.SELECT * FROM Food
WHERE 
  (price IN (10000,15000,20000))
  AND kind = 'Korean' -->
  	
  	  	
  	<!-- 회원가입 -->
  	<insert id="member_join" parameterType="member">
  		insert into food_member
  		values (#{user_id}, #{user_pwd}, #{user_name}, #{user_birth}, #{user_email}, #{user_phone})
  	</insert>
  	
  	<!-- 아이디 값 기준으로 회원정보 불러오기(로그인 체크)  -->
  	<select id="member_login" resultType="member">
  		select * from food_member where user_id = #{user_id}
  	</select>
  	
  	<!-- 회원정보 수정 -->
  	<update id="member_edit">
  		update food_member 
  		set 
  		user_name = #{user_name} 
  		,user_birth = #{user_birth}, user_email = #{user_email}
  		, user_phone = #{user_phone} 
  		where user_id = #{user_id} 
  	</update>

  	<update id="member_pwdEdit">
  	  	update food_member 
  		set user_pwd = #{user_pwd} where user_id = #{user_id} 
  	</update>
  	
  	 <!-- 회원정보 불러오기(관리자 멤버 검색)  -->
    <select id="member_search" resultType="member">
     select * from food_member
      <if test="search_type == 'All'">
      </if>
      <where>
      <if test="search_type == 'user_name'">
       user_name like #{search_field}
      </if>
      <if test="search_type == 'user_id'">
       user_id like #{search_field}
      </if>
      <if test="search_type == 'user_birth'">
       user_birth like #{search_field}
      </if>
      <if test="search_type == 'user_email'">
       user_email like #{search_field}
      </if>
      <if test="search_type == 'user_phone'">
       user_phone like #{search_field}
      </if>
      </where>
    </select>  
  	
  	
  	<!-- 찜하기 --><!-- 찜하기 --><!-- 찜하기 --><!-- 찜하기 --><!-- 찜하기 --><!-- 찜하기 --><!-- 찜하기 --><!-- 찜하기 --><!-- 찜하기 -->
  	
  	<!-- 찜하기 눌럿는지 안눌럿는지 카운트 -->
	<select id="like_count" resultType="int">
		select count(*) from food_like where food_no = #{food_no} and user_id = #{user_id}
	</select>
  	
  	<!-- 찜하기 -->
  	<insert id="likeUp">
		insert into food_like (like_no, food_no, user_id, like_cnt)
		values(like_no_seq.nextval, #{food_no}, #{session_id}, 1)
	</insert>
	
  	<!-- 찜하기 취소 -->
  	<delete id="likeDown">
	  	delete from food_like where food_no = #{food_no} and user_id = #{session_id} 
	</delete>
	
	<!-- 해당 id가 찜한 정보 -->
	<select id="items3" resultType="foodLike">
		  SELECT * FROM food_like WHERE user_id = #{session_id} AND food_no = #{food_no}
	</select>
  </mapper>
